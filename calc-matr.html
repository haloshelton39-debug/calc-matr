<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç –õ–∏—á–Ω–æ—Å—Ç–∏ ‚Äî –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç</title>
  <style>
    :root{
      --bg:#0b0b12;
      --card:#141427;
      --text:#e9e9f2;
      --muted:#b9b9cc;
      --primary:#7c3aed;
      --accent:#fbbf24;
      --danger:#fb7185;
      --border: rgba(255,255,255,0.09);
      --shadow: 0 14px 40px rgba(0,0,0,0.55);
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      line-height:1.6;
      background:
        radial-gradient(1200px 520px at 15% 10%, rgba(124,58,237,0.28), transparent 55%),
        radial-gradient(900px 420px at 88% 14%, rgba(251,191,36,0.18), transparent 50%),
        radial-gradient(900px 420px at 50% 100%, rgba(34,211,238,0.10), transparent 55%),
        var(--bg);
    }

    /* Layout */
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .nav{
      position:sticky; top:0; z-index:50;
      background: linear-gradient(180deg, rgba(11,11,18,0.92), rgba(11,11,18,0.62));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .navInner{max-width:1100px;margin:0 auto;padding:12px 22px;display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:0.3px}
    .brand .logo{
      width:34px;height:34px;border-radius:12px;
      background: linear-gradient(135deg, rgba(251,191,36,1), rgba(124,58,237,1));
      box-shadow: 0 10px 20px rgba(0,0,0,0.35);
    }
    .navLinks{display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end}
    .navLinks a{
      color:var(--muted);
      text-decoration:none;
      font-size:13px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid transparent;
    }
    .navLinks a:hover{
      color:var(--text);
      border-color: rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
    }

    .hero{
      padding:34px 0 10px;
      display:grid;
      grid-template-columns: 1.3fr 1fr;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 900px){
      .hero{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent 55%), var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:18px;
    }
    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), transparent 55%), rgba(20,20,39,0.72);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:18px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.35);
      padding:18px;
    }

    h1,h2,h3{margin:0 0 10px}
    h1{font-size:34px;line-height:1.15}
    .lead{color:var(--muted);margin:0 0 14px}
    .badges{display:flex;gap:10px;flex-wrap:wrap}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      font-size:13px;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:999px;background: var(--accent)}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{
      border:none; cursor:pointer;
      border-radius:14px;
      padding:12px 14px;
      font-weight:900;
      font-size:15px;
      transition: transform .15s ease, filter .15s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(0.98)}
    .btnPrimary{background: linear-gradient(90deg, var(--accent), #ffe08c); color:#0b0b12}
    .btnGhost{
      background: rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.10);
      color: var(--text);
    }
    .btnViolet{background: linear-gradient(90deg, rgba(124,58,237,1), rgba(167,139,250,1)); color:#0b0b12}
    .btnSmall{padding:10px 12px;font-size:14px;border-radius:12px}

    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:900px){.grid3{grid-template-columns:1fr}}
    .feat h3{margin:0 0 6px;font-size:16px}
    .feat p{margin:0;color:var(--muted);font-size:14px}

    /* App */
    .appWrap{padding:10px 0 30px}
    .sectionTitle{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .hint{color:var(--muted);font-size:13px}
    label{display:block;color:var(--muted);font-size:13px;margin:0 0 6px}
    input{
      width:100%;
      background: rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      font-size:16px;
    }
    input:focus{border-color: rgba(251,191,36,0.60); box-shadow:0 0 0 3px rgba(251,191,36,0.10)}
    .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.formGrid{grid-template-columns:1fr}}

    .mutedBox{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      background: rgba(255,255,255,0.03);
      border:1px dashed rgba(255,255,255,0.10);
      color:var(--muted);
      font-size:14px;
    }

    .row{
      display:flex;align-items:flex-start;justify-content:space-between;
      gap:14px;
      padding:10px 0;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .row:last-child{border-bottom:none}
    .k{color:var(--muted);font-size:14px}
    .v{
      font-weight:900;
      color:var(--accent);
      min-width:120px;
      text-align:right;
    }
    .bigNumber{
      font-size:34px;
      font-weight:1000;
      letter-spacing:0.6px;
      color:var(--accent);
    }
    .master{color: var(--danger) !important; text-shadow: 0 0 14px rgba(251,113,133,0.22)}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;
      background: rgba(124,58,237,0.14);
      border:1px solid rgba(124,58,237,0.22);
      border-radius:999px;
      color:#ddd6ff;
      font-size:13px;
      margin:6px 6px 0 0;
      white-space:nowrap;
    }
    .pill .pDot{width:8px;height:8px;border-radius:50%; background: var(--primary)}

    .matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    @media (max-width:760px){.matrix{grid-template-columns:1fr}}
    .cell{
      border:1px solid rgba(255,255,255,0.09);
      border-radius:16px;
      padding:12px;
      background: rgba(255,255,255,0.02);
    }
    .cell .n{font-weight:900;font-size:14px;color:var(--muted)}
    .cell .count{font-weight:1000;font-size:22px;color:var(--accent)}
    .barWrap{
      margin-top:8px;height:8px;border-radius:999px;overflow:hidden;
      background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.06);
    }
    .bar{height:100%; width:0%; background: linear-gradient(90deg, rgba(124,58,237,0.95), rgba(251,191,36,0.95))}
    .list{margin:10px 0 0; padding-left:18px}
    .list li{margin:6px 0}
    .warn{
      background: rgba(251,113,133,0.10);
      border:1px solid rgba(251,113,133,0.18);
      color:#ffd7df;
      padding:12px;
      border-radius:14px;
      margin-top:10px;
      font-size:14px;
    }

    /* Modal for HTML export */
    .modalOverlay{
      position:fixed; inset:0; z-index:200;
      background: rgba(0,0,0,0.65);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
    }
    .modal{
      width:min(980px, 100%);
      max-height: 86vh;
      overflow:auto;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(20,20,39,0.92);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0,0,0,0.55);
      padding:14px;
    }
    textarea{
      width:100%;
      min-height: 320px;
      resize: vertical;
      background: rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      color: var(--text);
      border-radius:14px;
      padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      outline:none;
    }
    .footer{
      padding:18px 0 34px;
      color: var(--muted);
      font-size:13px;
      text-align:center;
      opacity:0.95;
    }
    .anchor{scroll-margin-top: 90px;}
  </style>
</head>
<body>

  <!-- NAV -->
  <div class="nav">
    <div class="navInner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç</div>
      </div>
      <div class="navLinks">
        <a href="#how">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</a>
        <a href="#app">–†–∞—Å—á—ë—Ç</a>
        <a href="#faq">FAQ</a>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- HERO -->
    <div class="hero">
      <div class="glass">
        <h1>üîÆ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç –õ–∏—á–Ω–æ—Å—Ç–∏</h1>
        <p class="lead">
          –ü–æ–Ω—è—Ç–Ω—ã–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä: <strong>—Ö–∞—Ä–∞–∫—Ç–µ—Ä</strong>, <strong>–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</strong>,
          <strong>–¥–µ–Ω—å–≥–∏</strong>, <strong>–æ—Ç–Ω–æ—à–µ–Ω–∏—è</strong> –∏ <strong>—Ä–µ—Å—É—Ä—Å</strong> ‚Äî –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è, –§–ò–û –∏ –≥–æ—Ä–æ–¥—É —Ä–æ–∂–¥–µ–Ω–∏—è.
        </p>

        <div class="badges">
          <span class="badge"><span class="dot"></span>100% –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</span>
          <span class="badge"><span class="dot"></span>–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
          <span class="badge"><span class="dot"></span>–º–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å HTML-–æ—Ç—á—ë—Ç</span>
        </div>

        <div class="ctaRow">
          <a class="btn btnPrimary" href="#app" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center">
            –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á—ë—Ç
          </a>
          <button class="btn btnGhost" onclick="scrollToEl('how')">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</button>
        </div>

        <div class="mutedBox">
          ‚ö†Ô∏è –≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∞–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å. –†–µ—à–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –∑–∞ —Ç–æ–±–æ–π.
        </div>
      </div>

      <div class="card">
        <div class="sectionTitle">
          <h2 style="margin:0;font-size:18px">–ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∏—à—å</h2>
          <div class="hint">–∑–∞ 1‚Äì2 –º–∏–Ω—É—Ç—ã</div>
        </div>
        <div class="grid3" style="grid-template-columns:1fr;gap:10px">
          <div class="feat">
            <h3>–ö–ª—é—á –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
            <p>–ì–ª–∞–≤–Ω–∞—è —Ç–µ–º–∞ –∂–∏–∑–Ω–∏ –∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã ‚Äî –≤ –∫–æ—Ä–æ—Ç–∫–æ–π —Ñ–æ—Ä–º–µ, –±–µ–∑ ‚Äú–≤–æ–¥—ã‚Äù.</p>
          </div>
          <div class="feat">
            <h3>–ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç</h3>
            <p>–ö–æ–¥—ã + –º–∞—Ç—Ä–∏—Ü–∞ + –ø–æ—Ä—Ç—Ä–µ—Ç + —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏ + –ø—Ä–æ–≥–Ω–æ–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.</p>
          </div>
          <div class="feat">
            <h3>–≠–∫—Å–ø–æ—Ä—Ç –≤ HTML</h3>
            <p>–°–æ–±–∏—Ä–∞–µ–º –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–¥–∏–Ω HTML-—Ñ–∞–π–ª: –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å, —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- HOW -->
    <div class="card anchor" id="how">
      <div class="sectionTitle">
        <h2 style="margin:0">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
        <div class="hint">–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞</div>
      </div>
      <div class="grid3">
        <div class="feat">
          <h3>1) –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</h3>
          <p>–î–∞—ë—Ç –æ–±—â–∏–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –±–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (—á–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏).</p>
        </div>
        <div class="feat">
          <h3>2) –§–ò–û</h3>
          <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ç—ã –ø—Ä–æ—è–≤–ª—è–µ—à—å—Å—è –≤ –º–∏—Ä–µ: —Å—Ç–∏–ª—å –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, —Ä–æ–ª—å.</p>
        </div>
        <div class="feat">
          <h3>3) –ì–æ—Ä–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</h3>
          <p>–î–æ–±–∞–≤–ª—è–µ—Ç ‚Äú—Ñ–æ–Ω‚Äù: —Ç–µ–º–ø, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Å—Ä–µ–¥–∞ ‚Äî –∫–∞–∫ –º–µ—Å—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ.</p>
        </div>
      </div>
      <div class="mutedBox">
        ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è. –í—Å—ë —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
      </div>
    </div>

    <!-- APP -->
    <div class="appWrap anchor" id="app">
      <div class="card">
        <div class="sectionTitle">
          <h2 style="margin:0">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
          <div class="hint">5 –ø–æ–ª–µ–π ‚Äî –∏ –≥–æ—Ç–æ–≤–æ</div>
        </div>

        <div class="formGrid">
          <div>
            <label>–§–∞–º–∏–ª–∏—è</label>
            <input id="surname" type="text" placeholder="–ò–≤–∞–Ω–æ–≤" autocomplete="family-name">
          </div>
          <div>
            <label>–ò–º—è</label>
            <input id="name" type="text" placeholder="–ò–≤–∞–Ω" autocomplete="given-name">
          </div>
          <div>
            <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
            <input id="patronymic" type="text" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
          </div>
          <div>
            <label>–ì–æ—Ä–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ)</label>
            <input id="birthCity" type="text" placeholder="–ú–æ—Å–∫–≤–∞">
          </div>
          <div>
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input id="birthDate" type="date">
          </div>

          <div style="display:flex;align-items:end;gap:10px;flex-wrap:wrap">
            <button class="btn btnPrimary" style="flex:1" onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç</button>
            <button class="btn btnViolet btnSmall" style="flex:1" type="button" onclick="setMode('brief')">–ö—Ä–∞—Ç–∫–æ</button>
            <button class="btn btnGhost btnSmall" style="flex:1" type="button" onclick="setMode('full')">–ü–æ–¥—Ä–æ–±–Ω–æ</button>
          </div>
        </div>

        <div class="mutedBox" id="modeHint">
          –†–µ–∂–∏–º: <strong>–ü–æ–¥—Ä–æ–±–Ω–æ</strong> ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç —Å–æ –≤—Å–µ–º–∏ –±–ª–æ–∫–∞–º–∏.
        </div>
      </div>

      <div id="results" style="display:none">
        <div class="card" id="summaryCard"></div>

        <div class="card" id="coreCard" data-detail="full"></div>
        <div class="card" id="matrixCard" data-detail="full"></div>
        <div class="card" id="portraitCard" data-detail="full"></div>
        <div class="card" id="lifeAreasCard" data-detail="full"></div>
        <div class="card" id="forecastCard" data-detail="full"></div>

        <div class="card" id="recommendCard"></div>

        <div class="card">
          <div class="sectionTitle">
            <h2 style="margin:0">–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h2>
            <div class="hint">–≤–µ—Å—å –æ—Ç—á—ë—Ç –≤ HTML</div>
          </div>
          <div class="k">
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî –∏ –º—ã —Å–æ–±–µ—Ä—ë–º –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ <strong>–æ—Ç–¥–µ–ª—å–Ω—É—é HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> (—Å–æ —Å—Ç–∏–ª—è–º–∏), –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–æ—Ç–ø—Ä–∞–≤–∏—Ç—å/—Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å.
          </div>
          <div class="ctaRow">
            <button class="btn btnPrimary btnSmall" onclick="openExportModal()">–ü–æ–∫–∞–∑–∞—Ç—å HTML –æ—Ç—á—ë—Ç–∞</button>
            <button class="btn btnViolet btnSmall" onclick="downloadReportHtml()">–°–∫–∞—á–∞—Ç—å HTML</button>
            <button class="btn btnGhost btnSmall" onclick="openReportInNewTab()">–û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á—ë—Ç</button>
          </div>
          <div class="mutedBox">
            ‚ö° –≠–∫—Å–ø–æ—Ä—Ç –±–µ—Ä—ë—Ç –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ —Å–µ–π—á–∞—Å (–∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∂–∏–º: –∫—Ä–∞—Ç–∫–æ/–ø–æ–¥—Ä–æ–±–Ω–æ).
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="card anchor" id="faq">
      <div class="sectionTitle">
        <h2 style="margin:0">FAQ</h2>
        <div class="hint">–∫–æ—Ä–æ—Ç–∫–æ</div>
      </div>
      <div class="row">
        <div>
          <strong>–≠—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–æ–∏ –¥–∞–Ω–Ω—ã–µ –∫—É–¥–∞-—Ç–æ?</strong>
          <div class="k">–ù–µ—Ç. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</div>
        </div>
      </div>
      <div class="row">
        <div>
          <strong>–ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?</strong>
          <div class="k">–î–∞. –ù–∞–∂–º–∏ ¬´–°–∫–∞—á–∞—Ç—å HTML¬ª ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –æ—Ç—á—ë—Ç–æ–º.</div>
        </div>
      </div>
      <div class="row">
        <div>
          <strong>–ö—Ä–∞—Ç–∫–æ / –ü–æ–¥—Ä–æ–±–Ω–æ ‚Äî –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?</strong>
          <div class="k">–ö—Ä–∞—Ç–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É—Ç—å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –ü–æ–¥—Ä–æ–±–Ω–æ ‚Äî –≤–µ—Å—å –æ—Ç—á—ë—Ç: –∫–æ–¥—ã, –º–∞—Ç—Ä–∏—Ü–∞, –ø–æ—Ä—Ç—Ä–µ—Ç, —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏, –ø—Ä–æ–≥–Ω–æ–∑.</div>
        </div>
      </div>
    </div>

    <div class="footer">
      ¬© <span id="year"></span> –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç ‚Ä¢ –æ—Ñ–ª–∞–π–Ω-–ø—Ä–æ–¥—É–∫—Ç ‚Ä¢ –æ–¥–∏–Ω HTML-—Ñ–∞–π–ª
    </div>
  </div>

  <!-- Export Modal -->
  <div class="modalOverlay" id="exportModal" role="dialog" aria-modal="true" aria-label="HTML –æ—Ç—á—ë—Ç–∞">
    <div class="modal">
      <div class="sectionTitle">
        <h2 style="margin:0">HTML –æ—Ç—á—ë—Ç–∞</h2>
        <div class="hint">–º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª–∏–∫–æ–º</div>
      </div>

      <div class="ctaRow" style="margin-top:8px">
        <button class="btn btnPrimary btnSmall" onclick="copyReportHtml()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML</button>
        <button class="btn btnViolet btnSmall" onclick="downloadReportHtml()">–°–∫–∞—á–∞—Ç—å HTML</button>
        <button class="btn btnGhost btnSmall" onclick="openReportInNewTab()">–û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á—ë—Ç</button>
        <button class="btn btnGhost btnSmall" onclick="closeExportModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>

      <div style="margin-top:10px">
        <textarea id="exportTextarea" spellcheck="false"></textarea>
      </div>

      <div class="mutedBox">
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π HTML –º–æ–∂–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
      </div>
    </div>
  </div>

<script>
  // ====== Helpers ======
  document.getElementById('year').textContent = new Date().getFullYear();
  function scrollToEl(id){ document.getElementById(id)?.scrollIntoView({behavior:'smooth', block:'start'}); }

  // ====== Numerology tables ======
  const cyrillicMap = {
    '–∞': 1, '–∏': 1, '—Å': 1, '—ä': 1,
    '–±': 2, '–π': 2, '—Ç': 2, '—ã': 2,
    '–≤': 3, '–∫': 3, '—É': 3, '—å': 3,
    '–≥': 4, '–ª': 4, '—Ñ': 4, '—ç': 4,
    '–¥': 5, '–º': 5, '—Ö': 5, '—é': 5,
    '–µ': 6, '–Ω': 6, '—Ü': 6, '—è': 6,
    '—ë': 7, '–æ': 7, '—á': 7,
    '–∂': 8, '–ø': 8, '—à': 8,
    '–∑': 9, '—Ä': 9, '—â': 9
  };
  const latinMap = {
    'a': 1, 'j': 1, 's': 1,
    'b': 2, 'k': 2, 't': 2,
    'c': 3, 'l': 3, 'u': 3,
    'd': 4, 'm': 4, 'v': 4,
    'e': 5, 'n': 5, 'w': 5,
    'f': 6, 'o': 6, 'x': 6,
    'g': 7, 'p': 7, 'y': 7,
    'h': 8, 'q': 8, 'z': 8,
    'i': 9, 'r': 9
  };

  // Simplified meanings for broad audience (short + full)
  const meanings = {
    1: { title:"–õ–∏–¥–µ—Ä", short:"–ü—Ä–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É", text:"–¢—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—à—å—Å—è, –∫–æ–≥–¥–∞ —Å–∞–º –ø—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏—è. –°–∏–ª–∞ ‚Äî –Ω–∞—á–∏–Ω–∞—Ç—å –∏ –≤–µ—Å—Ç–∏. –í–∞–∂–Ω–æ –Ω–µ –¥–∞–≤–∏—Ç—å –Ω–∞ –ª—é–¥–µ–π –∏ —Å–ª—ã—à–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å." },
    2: { title:"–ü–∞—Ä—Ç–Ω—ë—Ä", short:"–ü—Ä–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ", text:"–¢—ã —Ç–æ–Ω–∫–æ —á—É–≤—Å—Ç–≤—É–µ—à—å –ª—é–¥–µ–π –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É. –°–∏–ª–∞ ‚Äî –≤ –¥–∏–ø–ª–æ–º–∞—Ç–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ. –í–∞–∂–Ω–æ –Ω–µ —Ä–∞—Å—Ç–≤–æ—Ä—è—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –∏ —É–º–µ—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–Ω–µ—Ç¬ª." },
    3: { title:"–ö–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä", short:"–ü—Ä–æ –æ–±—â–µ–Ω–∏–µ –∏ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ", text:"–¢—ã —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—à—å—Å—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞, –∏–¥–µ–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ. –°–∏–ª–∞ ‚Äî –≤ –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ —Ö–∞—Ä–∏–∑–º–µ. –í–∞–∂–Ω–æ –¥–æ–≤–æ–¥–∏—Ç—å –Ω–∞—á–∞—Ç–æ–µ –¥–æ –∫–æ–Ω—Ü–∞." },
    4: { title:"–ü—Ä–∞–∫—Ç–∏–∫", short:"–ü—Ä–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫", text:"–¢—ã –Ω–∞–¥—ë–∂–µ–Ω –∏ —É–º–µ–µ—à—å –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É. –°–∏–ª–∞ ‚Äî –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –í–∞–∂–Ω–æ –±—ã—Ç—å –≥–∏–±—á–µ –∏ –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –≤ —Ä—É—Ç–∏–Ω–µ." },
    5: { title:"–°–≤–æ–±–æ–¥–∞", short:"–ü—Ä–æ –¥–≤–∏–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–º–µ–Ω—ã", text:"–¢–µ–±–µ –≤–∞–∂–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏ –æ—â—É—â–µ–Ω–∏–µ –∂–∏–∑–Ω–∏. –°–∏–ª–∞ ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Å–º–µ–ª–æ—Å—Ç—å. –í–∞–∂–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ñ–æ–∫—É—Å –∏ –Ω–µ —Ä–∞—Å–ø—ã–ª—è—Ç—å—Å—è." },
    6: { title:"–ó–∞–±–æ—Ç–∞", short:"–ü—Ä–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –≥–∞—Ä–º–æ–Ω–∏—é", text:"–¢—ã —É–º–µ–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —É—é—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–≥–∏—Ö. –°–∏–ª–∞ ‚Äî —Ç–µ–ø–ª–æ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –í–∞–∂–Ω–æ –Ω–µ –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è –ª–∏—à–Ω–µ–µ –∏ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –∑–∞–±–æ—Ç—ã." },
    7: { title:"–ê–Ω–∞–ª–∏—Ç–∏–∫", short:"–ü—Ä–æ –≥–ª—É–±–∏–Ω—É –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ", text:"–¢—ã —Å–∫–ª–æ–Ω–µ–Ω —Ä–∞–∑–º—ã—à–ª—è—Ç—å –∏ –∏—Å–∫–∞—Ç—å —Å–º—ã—Å–ª. –°–∏–ª–∞ ‚Äî –≤ –∞–Ω–∞–ª–∏–∑–µ –∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –í–∞–∂–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –∏ –¥–µ–ª–∏—Ç—å—Å—è —Ç–µ–º, —á—Ç–æ —á—É–≤—Å—Ç–≤—É–µ—à—å." },
    8: { title:"–†–µ–∑—É–ª—å—Ç–∞—Ç", short:"–ü—Ä–æ –¥–µ–Ω—å–≥–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", text:"–¢—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –≤–ª–∏—è–Ω–∏–µ. –°–∏–ª–∞ ‚Äî —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –¥–æ–≤–æ–¥–∏—Ç—å –¥–æ –∏—Ç–æ–≥–æ–≤. –í–∞–∂–Ω–æ –Ω–µ —É—Ö–æ–¥–∏—Ç—å –≤ –∂—ë—Å—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å." },
    9: { title:"–°–º—ã—Å–ª", short:"–ü—Ä–æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª—å–∑—É", text:"–¢–µ–±–µ –≤–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–Ω–∞—á–∏–º–æ–µ. –°–∏–ª–∞ ‚Äî —à–∏—Ä–æ—Ç–∞ –≤–∑–≥–ª—è–¥–∞ –∏ —ç–º–ø–∞—Ç–∏—è. –í–∞–∂–Ω–æ –Ω–µ –≤—ã–≥–æ—Ä–∞—Ç—å, –ø—ã—Ç–∞—è—Å—å ¬´—Å–ø–∞—Å—Ç–∏ –≤—Å–µ—Ö¬ª." },
    11:{ title:"–ò–Ω—Ç—É–∏—Ü–∏—è", short:"–ü—Ä–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∏–¥–µ–∏", text:"–¢—ã —Ç–æ–Ω–∫–æ —á—É–≤—Å—Ç–≤—É–µ—à—å –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ –∏ –ª—é–¥–µ–π. –°–∏–ª–∞ ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∏ –≤–∏–¥–µ–Ω–∏–µ. –í–∞–∂–Ω–æ –∑–∞–∑–µ–º–ª—è—Ç—å—Å—è –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∏–¥–µ–∏ –≤ –¥–µ–π—Å—Ç–≤–∏—è." },
    22:{ title:"–°–æ–∑–¥–∞—Ç–µ–ª—å", short:"–ü—Ä–æ –º–∞—Å—à—Ç–∞–± –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é", text:"–¢—ã —Å–ø–æ—Å–æ–±–µ–Ω —Å—Ç—Ä–æ–∏—Ç—å –±–æ–ª—å—à–∏–µ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. –°–∏–ª–∞ ‚Äî —Å–∏—Å—Ç–µ–º–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ. –í–∞–∂–Ω–æ –Ω–µ –±–æ—è—Ç—å—Å—è –º–∞—Å—à—Ç–∞–±–∞ –∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —à–∞–≥–∞–º–∏." },
    33:{ title:"–ù–∞—Å—Ç–∞–≤–Ω–∏–∫", short:"–ü—Ä–æ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –≤–ª–∏—è–Ω–∏–µ", text:"–¢—ã –≤–ª–∏—è–µ—à—å —á–µ—Ä–µ–∑ –∑–∞–±–æ—Ç—É –∏ –ø—Ä–∏–º–µ—Ä. –°–∏–ª–∞ ‚Äî —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç—å. –í–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã –∏ –±–µ—Ä–µ—á—å —Ä–µ—Å—É—Ä—Å." }
  };

  const isMaster = (n) => [11,22,33].includes(n);

  function reduceNumber(num){
    if (!num || num === 0) return {root: 0, final: 0, isMaster:false};
    let current = num;
    let root = num;
    while (current > 9 && !isMaster(current)) {
      root = current;
      let s = 0;
      for (const ch of String(current)) s += Number(ch);
      current = s;
    }
    return {root, final: current, isMaster: isMaster(current)};
  }

  function digitsSumFromDate(dateStr){
    const digits = String(dateStr || "").replace(/\D/g,'');
    let sum = 0;
    for (const d of digits) sum += Number(d);
    return sum;
  }

  function gematria(str){
    const clean = String(str||"").toLowerCase().replace(/[^a-z–∞-—è—ë]/g,'');
    let sum = 0;
    for (const ch of clean){
      if (cyrillicMap[ch]) sum += cyrillicMap[ch];
      else if (latinMap[ch]) sum += latinMap[ch];
    }
    return sum;
  }

  function safeMeaning(n){
    return meanings[n] || {title:"", short:"", text:""};
  }

  function countDigitsInBirthdate(dateStr){
    const digits = String(dateStr||"").replace(/\D/g,'').split('');
    const counts = {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
    for (const d of digits){
      const n = Number(d);
      if (n >= 1 && n <= 9) counts[n] += 1;
    }
    return counts;
  }

  function strengthLabel(count){
    if (count === 0) return "–Ω–µ –≤—ã—Ä–∞–∂–µ–Ω–æ ‚Äî –Ω–∞–≤—ã–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è";
    if (count === 1) return "–≤ –Ω–æ—Ä–º–µ";
    if (count === 2) return "—Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞";
    return "–æ—á–µ–Ω—å –≤—ã—Ä–∞–∂–µ–Ω–æ";
  }

  function traitByDigit(n){
    const map = {
      1: {name:"–í–æ–ª—è –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä", plus:"—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", shadow:"—É–ø—Ä—è–º—Å—Ç–≤–æ, –¥–∞–≤–ª–µ–Ω–∏–µ"},
      2: {name:"–ß—É–≤—Å—Ç–≤–∞ –∏ —ç–º–ø–∞—Ç–∏—è", plus:"—á—É—Ç–∫–æ—Å—Ç—å, –∫–æ–Ω—Ç–∞–∫—Ç", shadow:"–ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è"},
      3: {name:"–°–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ", plus:"–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ", shadow:"—Ä–∞—Å–ø—ã–ª–µ–Ω–∏–µ"},
      4: {name:"–†–µ—Å—É—Ä—Å –∏ —Ä–µ–∂–∏–º", plus:"—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", shadow:"—Å—Ç—Ä–∞—Ö –ø–µ—Ä–µ–º–µ–Ω"},
      5: {name:"–õ–æ–≥–∏–∫–∞", plus:"—è—Å–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π", shadow:"—Å–æ–º–Ω–µ–Ω–∏—è/–ø–µ—Ä–µ–∫—Ä—É—Ç"},
      6: {name:"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", plus:"–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –∑–∞–±–æ—Ç–∞", shadow:"–∫–æ–Ω—Ç—Ä–æ–ª—å/–ø–µ—Ä–µ–≥—Ä—É–∑"},
      7: {name:"–ò–Ω—Ç—É–∏—Ü–∏—è –ø—É—Ç–∏", plus:"—á—É—Ç—å—ë, –ø–æ–≤–æ—Ä–æ—Ç—ã", shadow:"—É—Ö–æ–¥ –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ"},
      8: {name:"–î–µ–Ω—å–≥–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", plus:"—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤–ª–∏—è–Ω–∏–µ", shadow:"–∂—ë—Å—Ç–∫–æ—Å—Ç—å"},
      9: {name:"–ü–∞–º—è—Ç—å –∏ –º—É–¥—Ä–æ—Å—Ç—å", plus:"–æ–±—É—á–∞–µ–º–æ—Å—Ç—å, –≥–ª—É–±–∏–Ω–∞", shadow:"–∏–¥–µ–∞–ª–∏–∑–º"}
    };
    return map[n];
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");
  }

  // ====== View mode ======
  let VIEW_MODE = "full"; // "brief" | "full"

  function setMode(mode){
    VIEW_MODE = (mode === "brief") ? "brief" : "full";
    const el = document.getElementById("modeHint");
    if (el){
      el.innerHTML = VIEW_MODE === "full"
        ? `–†–µ–∂–∏–º: <strong>–ü–æ–¥—Ä–æ–±–Ω–æ</strong> ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç —Å–æ –≤—Å–µ–º–∏ –±–ª–æ–∫–∞–º–∏.`
        : `–†–µ–∂–∏–º: <strong>–ö—Ä–∞—Ç–∫–æ</strong> ‚Äî —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ (1‚Äì2 –º–∏–Ω—É—Ç—ã —á—Ç–µ–Ω–∏—è).`;
    }
    applyViewMode();
  }

  function applyViewMode(){
    const results = document.getElementById("results");
    if (!results) return;
    const fullBlocks = results.querySelectorAll('[data-detail="full"]');
    fullBlocks.forEach(el => {
      el.style.display = (VIEW_MODE === "full") ? "block" : "none";
    });
  }

  // ====== Calculation ======
  let LAST_REPORT_HTML = ""; // cached export

  function calculate(){
    const surname = document.getElementById('surname').value.trim();
    const name = document.getElementById('name').value.trim();
    const patronymic = document.getElementById('patronymic').value.trim();
    const birthCity = document.getElementById('birthCity').value.trim();
    const birthDate = document.getElementById('birthDate').value;

    if (!surname || !name || !patronymic || !birthCity || !birthDate){
      alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è: –§–∞–º–∏–ª–∏—è, –ò–º—è, –û—Ç—á–µ—Å—Ç–≤–æ, –ì–æ—Ä–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è.");
      return;
    }

    // Core numbers
    const dateSum = digitsSumFromDate(birthDate);
    const lifePath = reduceNumber(dateSum);

    const surCode = reduceNumber(gematria(surname));
    const nameCode = reduceNumber(gematria(name));
    const patCode = reduceNumber(gematria(patronymic));

    const cityCode = reduceNumber(gematria(birthCity));

    const fullName = `${surname} ${name} ${patronymic}`;
    const fullNameCode = reduceNumber(gematria(fullName));

    const coreRaw = lifePath.final + fullNameCode.final + cityCode.final;
    const core = reduceNumber(coreRaw);

    // Date layers
    const [yyyy, mm, dd] = birthDate.split('-').map(x => Number(x));
    const dayCode = reduceNumber(dd);
    const monthCode = reduceNumber(mm);
    const yearCode = reduceNumber(yyyy);

    // Matrix
    const counts = countDigitsInBirthdate(birthDate);

    const strengths = [];
    const growth = [];
    for (let i=1;i<=9;i++){
      const c = counts[i];
      const t = traitByDigit(i);
      if (c >= 2) strengths.push({i,c,t});
      if (c === 0) growth.push({i,c,t});
    }

    // Render cards
    renderSummary(fullName, birthCity, birthDate, core);
    renderCore(lifePath, fullNameCode, cityCode, core, surCode, nameCode, patCode, dayCode, monthCode, yearCode);
    renderMatrix(counts);
    renderPortrait(lifePath, core, surCode, nameCode, patCode, cityCode, strengths, growth);
    renderLifeAreas(lifePath, core, fullNameCode, cityCode, counts);
    renderForecast(lifePath, core);
    renderRecommendations(lifePath, core, strengths, growth);

    const res = document.getElementById('results');
    res.style.display = 'block';
    applyViewMode();
    res.scrollIntoView({behavior:'smooth', block:'start'});

    // Build report HTML cache
    LAST_REPORT_HTML = buildReportHtmlDocument({
      viewMode: VIEW_MODE,
      fullName,
      birthCity,
      birthDate,
      blocks: collectBlocksForExport()
    });
  }

  // ====== Render blocks ======
  function renderSummary(fullName, city, birthDate, core){
    const m = safeMeaning(core.final);
    const masterClass = core.isMaster ? "master" : "";
    const descr = (VIEW_MODE === "full") ? m.text : m.short;

    document.getElementById('summaryCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–ü–∞—Å–ø–æ—Ä—Ç –ª–∏—á–Ω–æ—Å—Ç–∏</h2>
        <div class="hint">–∏—Ç–æ–≥–æ–≤—ã–π –∫–ª—é—á</div>
      </div>

      <div class="row">
        <div class="k">–§–ò–û</div>
        <div class="v" style="min-width:auto;text-align:right">${escapeHtml(fullName)}</div>
      </div>
      <div class="row">
        <div class="k">–ì–æ—Ä–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
        <div class="v" style="min-width:auto;text-align:right">${escapeHtml(city)}</div>
      </div>
      <div class="row">
        <div class="k">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
        <div class="v" style="min-width:auto;text-align:right">${escapeHtml(new Date(birthDate).toLocaleDateString('ru-RU'))}</div>
      </div>

      <div class="row" style="align-items:center">
        <div>
          <div class="k">–õ–∏—á–Ω–æ–µ —è–¥—Ä–æ (–≥–ª–∞–≤–Ω–∞—è —Ç–µ–º–∞)</div>
          <div style="margin-top:6px;color:var(--muted);font-size:14px">
            ${m.title ? `<span class="pill"><span class="pDot"></span>${escapeHtml(m.title)}</span>` : ``}
            ${m.short ? `<span class="pill"><span class="pDot"></span>${escapeHtml(m.short)}</span>` : ``}
          </div>
        </div>
        <div class="bigNumber ${masterClass}">${core.final}</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>${escapeHtml(m.title || "–ö–ª—é—á")}</strong><br/>
        ${escapeHtml(descr || "")}
        ${VIEW_MODE === "brief" ? `<div style="margin-top:10px;color:var(--muted)">–ü–µ—Ä–µ–∫–ª—é—á–∏ –Ω–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–æ¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–µ—Å—å –æ—Ç—á—ë—Ç.</div>` : ``}
      </div>
    `;
  }

  function renderCore(lifePath, fullNameCode, cityCode, core, surCode, nameCode, patCode, dayCode, monthCode, yearCode){
    const mLP = safeMeaning(lifePath.final);
    const mFN = safeMeaning(fullNameCode.final);
    const mCity = safeMeaning(cityCode.final);
    const mCore = safeMeaning(core.final);

    const pick = (m) => (VIEW_MODE === "full") ? m.text : m.short;
    const badge = (obj) => obj.isMaster ? "master" : "";

    document.getElementById('coreCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–ö–ª—é—á–µ–≤—ã–µ –∫–æ–¥—ã</h2>
        <div class="hint">–∏–∑ —á–µ–≥–æ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ—Ä—Ç—Ä–µ—Ç</div>
      </div>

      <div class="row">
        <div>
          <div><strong>üéÇ –ß–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏</strong></div>
          <div class="k"><strong>${escapeHtml(mLP.title)}</strong> ‚Äî ${escapeHtml(pick(mLP) || "")}</div>
        </div>
        <div class="v ${badge(lifePath)}">${lifePath.final} <span class="k">(–∫–æ—Ä–µ–Ω—å ${lifePath.root})</span></div>
      </div>

      <div class="row">
        <div>
          <div><strong>üßæ –ö–æ–¥ –§–ò–û</strong></div>
          <div class="k"><strong>${escapeHtml(mFN.title)}</strong> ‚Äî ${escapeHtml(pick(mFN) || "")}</div>
          <div style="margin-top:6px">
            <span class="pill"><span class="pDot"></span>–§–∞–º–∏–ª–∏—è: ${surCode.final}</span>
            <span class="pill"><span class="pDot"></span>–ò–º—è: ${nameCode.final}</span>
            <span class="pill"><span class="pDot"></span>–û—Ç—á–µ—Å—Ç–≤–æ: ${patCode.final}</span>
          </div>
        </div>
        <div class="v ${badge(fullNameCode)}">${fullNameCode.final}</div>
      </div>

      <div class="row">
        <div>
          <div><strong>üèôÔ∏è –ö–æ–¥ –≥–æ—Ä–æ–¥–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</strong></div>
          <div class="k"><strong>${escapeHtml(mCity.title)}</strong> ‚Äî ${escapeHtml(pick(mCity) || "")}</div>
        </div>
        <div class="v ${badge(cityCode)}">${cityCode.final}</div>
      </div>

      <div class="row" style="border-top:1px dashed rgba(255,255,255,0.18); padding-top:14px;">
        <div>
          <div><strong>üî• –õ–∏—á–Ω–æ–µ —è–¥—Ä–æ</strong></div>
          <div class="k"><strong>${escapeHtml(mCore.title)}</strong> ‚Äî ${escapeHtml(pick(mCore) || "")}</div>
        </div>
        <div class="v ${badge(core)}" style="font-size:22px">${core.final}</div>
      </div>

      <div class="mutedBox">
        –°–ª–æ–∏ –¥–∞—Ç—ã:
        <div style="margin-top:6px">
          <span class="pill"><span class="pDot"></span>–î–µ–Ω—å: ${dayCode.final}</span>
          <span class="pill"><span class="pDot"></span>–ú–µ—Å—è—Ü: ${monthCode.final}</span>
          <span class="pill"><span class="pDot"></span>–ì–æ–¥: ${yearCode.final}</span>
        </div>
      </div>
    `;
  }

  function renderMatrix(counts){
    let cells = "";
    for (let i=1;i<=9;i++){
      const c = counts[i];
      const percent = Math.min(100, c * 33);
      const t = traitByDigit(i);
      cells += `
        <div class="cell" title="${escapeHtml(t.name)}">
          <div class="n">${i} ‚Äî ${escapeHtml(t.name)}</div>
          <div class="count">${c}</div>
          <div class="k">${strengthLabel(c)} ‚Ä¢ + ${escapeHtml(t.plus)} ‚Ä¢ —Ç–µ–Ω—å: ${escapeHtml(t.shadow)}</div>
          <div class="barWrap"><div class="bar" style="width:${percent}%"></div></div>
        </div>
      `;
    }

    document.getElementById('matrixCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–ú–∞—Ç—Ä–∏—Ü–∞ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è</h2>
        <div class="hint">–≥–¥–µ —É—Å–∏–ª–µ–Ω–æ, –∞ –≥–¥–µ –Ω–∞–≤—ã–∫</div>
      </div>
      <div class="k">–≠—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞: –∫–∞–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–ª—å–Ω–µ–µ –ø—Ä–æ—è–≤–ª–µ–Ω—ã ‚Äú–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é‚Äù, –∞ –∫–∞–∫–∏–µ –ª—É—á—à–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É.</div>
      <div class="matrix">${cells}</div>
    `;
  }

  function renderPortrait(lifePath, core, surCode, nameCode, patCode, cityCode, strengths, growth){
    const lp = safeMeaning(lifePath.final);
    const co = safeMeaning(core.final);

    const strengthsList = strengths.length
      ? `<ul class="list">${strengths
          .slice(0,6)
          .map(s => `<li><strong>${s.i} ‚Äî ${escapeHtml(s.t.name)}</strong>: —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (${s.c}). –ü–ª—é—Å: ${escapeHtml(s.t.plus)}.</li>`)
          .join('')}</ul>`
      : `<div class="mutedBox">–ü—Ä–æ—Ñ–∏–ª—å —Ä–æ–≤–Ω—ã–π: —Å–∏–ª–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ä–µ–∂–∏–º –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.</div>`;

    const growthList = growth.length
      ? `<ul class="list">${growth
          .slice(0,6)
          .map(g => `<li><strong>${g.i} ‚Äî ${escapeHtml(g.t.name)}</strong>: –∑–æ–Ω–∞ —Ä–æ—Å—Ç–∞. –ù–∞—á–Ω–∏ —Å –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤, –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.</li>`)
          .join('')}</ul>`
      : `<div class="mutedBox">–ù–µ—Ç ‚Äú–ø—É—Å—Ç—ã—Ö‚Äù —Ü–∏—Ñ—Ä: –ø—Ä–æ—Ñ–∏–ª—å –≥–∏–±–∫–∏–π –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π.</div>`;

    document.getElementById('portraitCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç</h2>
        <div class="hint">–∫–∞–∫ —Ç—ã –ø—Ä–æ—è–≤–ª—è–µ—à—å—Å—è</div>
      </div>

      <div class="row">
        <div>
          <div><strong>–ì–ª–∞–≤–Ω–∞—è –ª–∏–Ω–∏—è (–ø—É—Ç—å)</strong></div>
          <div class="k"><strong>${escapeHtml(lp.title)}</strong> ‚Äî ${escapeHtml(lp.text)}</div>
        </div>
        <div class="v ${lifePath.isMaster ? "master":""}">${lifePath.final}</div>
      </div>

      <div class="row">
        <div>
          <div><strong>–ì–ª–∞–≤–Ω—ã–π –≤–µ–∫—Ç–æ—Ä (—è–¥—Ä–æ)</strong></div>
          <div class="k"><strong>${escapeHtml(co.title)}</strong> ‚Äî ${escapeHtml(co.text)}</div>
        </div>
        <div class="v ${core.isMaster ? "master":""}">${core.final}</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>–ö–∞–∫ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ:</strong><br/>
        ‚Ä¢ –§–∞–º–∏–ª–∏—è: <strong>${surCode.final}</strong> ‚Äî —Ä–æ–¥–æ–≤–∞—è –ª–∏–Ω–∏—è –∏ ‚Äú–æ–ø–æ—Ä–∞‚Äù.<br/>
        ‚Ä¢ –ò–º—è: <strong>${nameCode.final}</strong> ‚Äî –∫–∞–∫ –¥–µ–π—Å—Ç–≤—É–µ—à—å –≤ –º–æ–º–µ–Ω—Ç–µ.<br/>
        ‚Ä¢ –û—Ç—á–µ—Å—Ç–≤–æ: <strong>${patCode.final}</strong> ‚Äî —Å—Ç–∏–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π/–ª—é–¥—å–º–∏.<br/>
        ‚Ä¢ –ì–æ—Ä–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: <strong>${cityCode.final}</strong> ‚Äî —Ñ–æ–Ω–æ–≤—ã–π —Ç–µ–º–ø –∏ —É—Å–ª–æ–≤–∏—è.
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h3>
          <span class="hint">—á—Ç–æ —É–∂–µ ‚Äú–≤ —Ä–µ—Å—É—Ä—Å–µ‚Äù</span>
        </div>
        ${strengthsList}
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">–ó–æ–Ω—ã —Ä–æ—Å—Ç–∞</h3>
          <span class="hint">—á—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–æ–∫–∞—á–∞—Ç—å</span>
        </div>
        ${growthList}
      </div>
    `;
  }

  function renderLifeAreas(lifePath, core, fullNameCode, cityCode, counts){
    const lp = safeMeaning(lifePath.final);
    const co = safeMeaning(core.final);
    const nn = safeMeaning(fullNameCode.final);
    const gc = safeMeaning(cityCode.final);

    const career = buildCareerBlock(core.final, lifePath.final);
    const money  = buildMoneyBlock(core.final, fullNameCode.final);
    const love   = buildLoveBlock(core.final, lifePath.final);
    const energy = buildEnergyBlock(core.final, counts);

    document.getElementById('lifeAreasCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–°—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏</h2>
        <div class="hint">—Ä–∞–±–æ—Ç–∞ ‚Ä¢ –¥–µ–Ω—å–≥–∏ ‚Ä¢ –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚Ä¢ —Ä–µ—Å—É—Ä—Å</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>–ö–ª—é—á–∏:</strong><br/>
        ‚Ä¢ –ü—É—Ç—å: <strong>${lifePath.final}</strong> ‚Äî ${escapeHtml(lp.title || "")}<br/>
        ‚Ä¢ –Ø–¥—Ä–æ: <strong>${core.final}</strong> ‚Äî ${escapeHtml(co.title || "")}<br/>
        ‚Ä¢ –ò–º—è: <strong>${fullNameCode.final}</strong> ‚Äî ${escapeHtml(nn.title || "")}<br/>
        ‚Ä¢ –ì–æ—Ä–æ–¥: <strong>${cityCode.final}</strong> ‚Äî ${escapeHtml(gc.title || "")}
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">üíº –†–∞–±–æ—Ç–∞ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h3>
          <span class="hint">–≥–¥–µ –ø—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è</span>
        </div>
        <div class="mutedBox" style="color:var(--text)">${career}</div>
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">üí∞ –î–µ–Ω—å–≥–∏ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ—Ö–æ–¥–∞</h3>
          <span class="hint">–∫–∞–∫ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</span>
        </div>
        <div class="mutedBox" style="color:var(--text)">${money}</div>
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">‚ù§Ô∏è –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è</h3>
          <span class="hint">—á—Ç–æ –≤–∞–∂–Ω–æ –≤ –±–ª–∏–∑–æ—Å—Ç–∏</span>
        </div>
        <div class="mutedBox" style="color:var(--text)">${love}</div>
      </div>

      <div style="margin-top:12px">
        <div class="sectionTitle" style="margin-bottom:6px">
          <h3 style="margin:0;font-size:16px">üîã –†–µ—Å—É—Ä—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</h3>
          <span class="hint">–∫–∞–∫ –Ω–µ –≤—ã–≥–æ—Ä–∞—Ç—å</span>
        </div>
        <div class="mutedBox" style="color:var(--text)">${energy}</div>
      </div>
    `;
  }

  function renderForecast(lifePath, core){
    const today = new Date();
    const day = today.getDate();
    const month = today.getMonth() + 1;
    const year = today.getFullYear();

    const universalDay = reduceNumber(day + month + year);
    const personalDay = reduceNumber(universalDay.final + lifePath.final);

    const universalMonth = reduceNumber(month + year);
    const personalMonth = reduceNumber(universalMonth.final + lifePath.final);

    const personalYear = reduceNumber(year + lifePath.final);

    const uDayMeaning = safeMeaning(universalDay.final);
    const pDayMeaning = safeMeaning(personalDay.final);

    document.getElementById('forecastCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–ü—Ä–æ–≥–Ω–æ–∑ –∏ —Ü–∏–∫–ª—ã</h2>
        <div class="hint">–¥–µ–Ω—å ‚Ä¢ –º–µ—Å—è—Ü ‚Ä¢ –≥–æ–¥</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>–°–µ–≥–æ–¥–Ω—è:</strong> ${today.toLocaleDateString('ru-RU')}
      </div>

      <div class="row">
        <div>
          <strong>üåç –û–±—â–∞—è —ç–Ω–µ—Ä–≥–∏—è –¥–Ω—è</strong>
          <div class="k"><strong>${escapeHtml(uDayMeaning.title)}</strong> ‚Äî ${escapeHtml(uDayMeaning.short || uDayMeaning.text || "")}</div>
        </div>
        <div class="v">${universalDay.final}</div>
      </div>

      <div class="row">
        <div>
          <strong>‚ö° –¢–≤–æ–π –ª–∏—á–Ω—ã–π –¥–µ–Ω—å</strong>
          <div class="k"><strong>${escapeHtml(pDayMeaning.title)}</strong> ‚Äî ${escapeHtml(pDayMeaning.short || pDayMeaning.text || "")}</div>
        </div>
        <div class="v ${personalDay.isMaster ? "master" : ""}">${personalDay.final}</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>–õ–∏—á–Ω—ã–π –º–µ—Å—è—Ü:</strong> ${personalMonth.final}<br/>
        <strong>–õ–∏—á–Ω—ã–π –≥–æ–¥:</strong> ${personalYear.final}<br/>
        <div style="margin-top:8px;color:var(--muted)">
          –°–æ–≤–µ—Ç: –¥–µ–π—Å—Ç–≤—É–π —á–µ—Ä–µ–∑ –∫–∞—á–µ—Å—Ç–≤–∞ —á–∏—Å–ª–∞ <strong>${personalDay.final}</strong>.
          ${personalDay.final === core.final ? " –°–µ–≥–æ–¥–Ω—è —Å–∏–ª—å–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å —Å —Ç–≤–æ–∏–º —è–¥—Ä–æ–º ‚Äî —Ö–æ—Ä–æ—à–∏–π –¥–µ–Ω—å –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π." : ""}
        </div>
      </div>
    `;
  }

  function renderRecommendations(lifePath, core, strengths, growth){
    const lp = safeMeaning(lifePath.final);
    const co = safeMeaning(core.final);

    const tips = [];

    // Core
    if ([1,8,4,22].includes(core.final)) tips.push("–§–æ–∫—É—Å –Ω–∞ —Ü–µ–ª–∏: –≤—ã–±–µ—Ä–∏ 1‚Äì2 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∏–∑–º–µ—Ä–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–ª–∞–Ω –Ω–∞ 30 –¥–Ω–µ–π).");
    if ([2,6,33].includes(core.final)) tips.push("–ì—Ä–∞–Ω–∏—Ü—ã: –ø–æ–º–æ–≥–∞—Ç—å ‚Äî –¥–∞, ‚Äú—Ç–∞—â–∏—Ç—å‚Äù —á—É–∂–∏–µ –∑–∞–¥–∞—á–∏ ‚Äî –Ω–µ—Ç. –ü–ª–∞–Ω–∏—Ä—É–π –æ—Ç–¥—ã—Ö.");
    if ([3,5].includes(core.final)) tips.push("–°–∏–ª–∞ ‚Äî –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ –≥–∏–±–∫–æ—Å—Ç–∏. –£—Å–ø–µ—Ö ‚Äî —á–µ—Ä–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ: –º–µ–Ω—å—à–µ —Å—Ç–∞—Ä—Ç–æ–≤, –±–æ–ª—å—à–µ —Ñ–∏–Ω–∏—à–µ–π.");
    if ([7,9,11].includes(core.final)) tips.push("–ë–µ—Ä–µ–≥–∏ –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É: —Ç–∏—à–∏–Ω–∞/—Å–æ–Ω/–ø—Ä–æ–≥—É–ª–∫–∏. –ò–¥–µ–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏.");

    // Growth zones
    const g = growth.slice(0,4).map(x => x.i);
    if (g.includes(1)) tips.push("–ü—Ä–æ–∫–∞—á–∫–∞ –≤–æ–ª–∏: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å 1 –º–∞–ª–µ–Ω—å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.");
    if (g.includes(4)) tips.push("–ü—Ä–æ–∫–∞—á–∫–∞ —Ä–µ—Å—É—Ä—Å–∞: —Å–æ–Ω + —Ä–µ–∂–∏–º. –ù–∞—á–Ω–∏ —Å 2 —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫.");
    if (g.includes(8)) tips.push("–ü—Ä–æ–∫–∞—á–∫–∞ –¥–µ–Ω–µ–≥: —É—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ + –æ–¥–Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å –Ω–∞ –º–µ—Å—è—Ü.");
    if (g.includes(3)) tips.push("–ü—Ä–æ–∫–∞—á–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è: –≥–æ–≤–æ—Ä–∏—Ç—å/–ø–∏—Å–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–¥–Ω–µ–≤–Ω–∏–∫, –∑–∞–º–µ—Ç–∫–∏, –∫–æ–Ω—Ç–µ–Ω—Ç).");
    if (g.includes(5)) tips.push("–ü—Ä–æ–∫–∞—á–∫–∞ –ª–æ–≥–∏–∫–∏: ¬´—Ñ–∞–∫—Ç—ã ‚Üí –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Üí –≤—ã–±–æ—Ä¬ª –≤ —Ä–µ—à–µ–Ω–∏—è—Ö.");

    // Strengths
    const s = strengths.slice(0,3).map(x => x.i);
    if (s.includes(1)) tips.push("–°–∏–ª–∞ –ª–∏–¥–µ—Ä–∞: –±–µ—Ä–∏ —Ä–æ–ª—å –≤–µ–¥—É—â–µ–≥–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ, –≥–¥–µ –µ—Å—Ç—å —Ü–µ–ª—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.");
    if (s.includes(3)) tips.push("–°–∏–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: –ø—Ä–æ—è–≤–ª—è–π—Å—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–æ, –∏–¥–µ–∏, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –∫–æ–Ω—Ç–µ–Ω—Ç.");
    if (s.includes(8)) tips.push("–°–∏–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: —Å—Ç–∞–≤—å KPI –∏ —Å—Ç—Ä–æ–π —Å–∏—Å—Ç–µ–º—É ‚Äî —ç—Ç–æ —Ç–≤–æ–π —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å.");
    if (s.includes(7)) tips.push("–°–∏–ª–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: —Ä–∞–∑–≤–∏–≤–∞–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ.");

    const uniqueTips = [...new Set(tips)].slice(0,10);

    document.getElementById('recommendCard').innerHTML = `
      <div class="sectionTitle">
        <h2 style="margin:0">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
        <div class="hint">—á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ</div>
      </div>

      <div class="mutedBox" style="color:var(--text)">
        <strong>–¢–≤–æ–π –≤–µ–∫—Ç–æ—Ä:</strong> —Å–æ–µ–¥–∏–Ω–∏—Ç—å <strong>${escapeHtml(lp.title || "–ü—É—Ç—å")}</strong> –∏ <strong>${escapeHtml(co.title || "–Ø–¥—Ä–æ")}</strong>.
        <div style="margin-top:6px;color:var(--muted)">
          –§–æ—Ä–º—É–ª–∞: ¬´–¥–µ–ª–∞—é –ø–æ-—Å–≤–æ–µ–º—É ‚Üí –¥–æ–≤–æ–∂—É –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è—é –±–∞–ª–∞–Ω—Å¬ª.
        </div>
      </div>

      <ul class="list">
        ${uniqueTips.map(t => `<li>${escapeHtml(t)}</li>`).join('')}
      </ul>

      ${(lifePath.isMaster || core.isMaster) ? `
        <div class="warn">
          ‚ö†Ô∏è –ï—Å—Ç—å –º–∞—Å—Ç–µ—Ä-—á–∏—Å–ª–æ: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤—ã—Å–æ–∫–∏–π, –Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∂–µ –≤—ã—à–µ.
          –õ—É—á—à–µ–µ –ø—Ä–∞–≤–∏–ª–æ: <strong>–∑–∞–∑–µ–º–ª–µ–Ω–∏–µ</strong> (—Ä–µ–∂–∏–º, —Ç–µ–ª–æ, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á) –∏ <strong>–≥—Ä–∞–Ω–∏—Ü—ã</strong>.
        </div>
      ` : ``}
    `;
  }

  // ====== Life areas text builders ======
  function buildCareerBlock(core, lifePath){
    const lines = [];
    if ([1,4,8,22].includes(core)) {
      lines.push("–í–µ–∫—Ç–æ—Ä ‚Äî <strong>—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç</strong>. –ü–æ–¥–æ–π–¥—É—Ç: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å, –ø—Ä–æ–¥–∞–∫—Ç/–ø—Ä–æ–µ–∫—Ç, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Ñ–∏–Ω–∞–Ω—Å—ã.");
      lines.push("–õ—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ü–µ–ª—å, —Å—Ä–æ–∫–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –∏—Ç–æ–≥.");
    } else if ([2,6,33].includes(core)) {
      lines.push("–í–µ–∫—Ç–æ—Ä ‚Äî <strong>–ª—é–¥–∏, —Å–µ—Ä–≤–∏—Å, –≥–∞—Ä–º–æ–Ω–∏—è</strong>. –ü–æ–¥–æ–π–¥—É—Ç: HR, –æ–±—É—á–µ–Ω–∏–µ, –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è/–∫–æ—É—á–∏–Ω–≥, –º–µ–¥–∏—Ü–∏–Ω–∞/—É—Ö–æ–¥, –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å, –∫–æ–º—å—é–Ω–∏—Ç–∏.");
      lines.push("–í–∞–∂–Ω–æ: –≥—Ä–∞–Ω–∏—Ü—ã –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–∞ –ø–æ–º–æ—â–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å—Å—è.");
    } else if ([3,5].includes(core)) {
      lines.push("–í–µ–∫—Ç–æ—Ä ‚Äî <strong>–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –¥–≤–∏–∂–µ–Ω–∏–µ</strong>. –ü–æ–¥–æ–π–¥—É—Ç: –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ø—Ä–æ–¥–∞–∂–∏, –º–µ–¥–∏–∞, –∫–æ–Ω—Ç–µ–Ω—Ç, –∏–≤–µ–Ω—Ç—ã, –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã.");
      lines.push("–ö–ª—é—á —É—Å–ø–µ—Ö–∞ ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ: –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç –¥–æ –∫–æ–Ω—Ü–∞, –ø–æ—Ç–æ–º —Å–ª–µ–¥—É—é—â–∏–π.");
    } else if ([7,9,11].includes(core)) {
      lines.push("–í–µ–∫—Ç–æ—Ä ‚Äî <strong>–≥–ª—É–±–∏–Ω–∞, —Å–º—ã—Å–ª, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞</strong>. –ü–æ–¥–æ–π–¥—É—Ç: –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–µ, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.");
      lines.push("–í–∞–∂–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∏–¥–µ–∏ –≤ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π, –∞ –Ω–µ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ.");
    } else {
      lines.push("–ü—Ä–æ—Ñ–∏–ª—å –≥–∏–±–∫–∏–π: –ø—Ä–æ–±—É–π —Ä–æ–ª–∏ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –≤—ã–±–∏—Ä–∞–π —Ç–æ, –≥–¥–µ –µ—Å—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ –∏ —Ä–æ—Å—Ç.");
    }

    if (lifePath === 5) lines.push("–ü—É—Ç—å 5 —É—Å–∏–ª–∏–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å–≤–æ–±–æ–¥–µ: –≤—ã–±–∏—Ä–∞–π —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º –∏ –¥–≤–∏–∂–µ–Ω–∏–µ–º.");
    if (lifePath === 4) lines.push("–ü—É—Ç—å 4 —É—Å–∏–ª–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—å: —Å–∏–ª—å–Ω—ã —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã, –ø—Ä–æ—Ü–µ—Å—Å—ã, —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã.");
    if (lifePath === 9) lines.push("–ü—É—Ç—å 9 —É—Å–∏–ª–∏–≤–∞–µ—Ç —Å–º—ã—Å–ª: –≤–∞–∂–Ω–æ –æ—â—É—â–∞—Ç—å –ø–æ–ª—å–∑—É –ª—é–¥—è–º/–º–∏—Ä—É.");

    return lines.join("<br/>");
  }

  function buildMoneyBlock(core, nameCode){
    const lines = [];
    if ([8,22].includes(core)) {
      lines.push("–î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±</strong>: —Å–∏—Å—Ç–µ–º–∞, –∫–æ–º–∞–Ω–¥–∞, –ø—Ä–æ—Ü–µ—Å—Å—ã.");
      lines.push("–ü—Ä–∞–≤–∏–ª–æ: —Å—á–∏—Ç–∞—Ç—å, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–æ–ª–≥—É—é.");
    } else if ([1,4].includes(core)) {
      lines.push("–î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É + –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É</strong>: —Ç—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—à—å, –∫–æ–≥–¥–∞ –≤–µ–¥—ë—à—å –∏ —Å—Ç—Ä–æ–∏—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É.");
      lines.push("–ü–æ–¥—Ö–æ–¥–∏—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ + —Ä–æ—Å—Ç –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏.");
    } else if ([3,5].includes(core)) {
      lines.push("–î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å</strong>: –ø—Ä–æ–¥–∞–∂–∏, —Å–≤—è–∑–∏, –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å.");
      lines.push("–†–∏—Å–∫: –∏–º–ø—É–ª—å—Å–∏–≤–Ω—ã–µ —Ç—Ä–∞—Ç—ã. –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ: ¬´—Å–Ω–∞—á–∞–ª–∞ —Ä–µ–∑–µ—Ä–≤, –ø–æ—Ç–æ–º —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ¬ª.");
    } else if ([2,6,33].includes(core)) {
      lines.push("–î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>—Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ª—é–¥–µ–π</strong>: —Å–µ—Ä–≤–∏—Å, –∑–∞–±–æ—Ç–∞, —ç—Å—Ç–µ—Ç–∏–∫–∞, –æ–±—É—á–µ–Ω–∏–µ.");
      lines.push("–í–∞–∂–Ω–æ –Ω–µ –∑–∞–Ω–∏–∂–∞—Ç—å —Ü–µ–Ω—É: —Ñ–∏–∫—Å–∏—Ä—É–π —É—Å–ª–æ–≤–∏—è –∑–∞—Ä–∞–Ω–µ–µ.");
    } else if ([7,9,11].includes(core)) {
      lines.push("–î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ <strong>—ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É</strong>: –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏–µ, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.");
      lines.push("–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç, –∫–æ–≥–¥–∞ —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—à—å –∑–Ω–∞–Ω–∏—è –≤ –ø—Ä–æ–¥—É–∫—Ç.");
    }

    if ([8,1,4].includes(nameCode)) lines.push("–ö–æ–¥ –∏–º–µ–Ω–∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å: –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —á—ë—Ç–∫–∏–µ –æ–±–µ—â–∞–Ω–∏—è.");
    if ([3,5].includes(nameCode)) lines.push("–ö–æ–¥ –∏–º–µ–Ω–∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.");
    if ([2,6,9].includes(nameCode)) lines.push("–ö–æ–¥ –∏–º–µ–Ω–∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ: –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–∏—Å–∞.");

    return lines.join("<br/>");
  }

  function buildLoveBlock(core, lifePath){
    const lines = [];
    if ([2,6,33].includes(core)) {
      lines.push("–í–∞–∂–Ω—ã <strong>—Ç–µ–ø–ª–æ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</strong>.");
      lines.push("–¢–µ–Ω—å: —Ä–∞—Å—Ç–≤–æ—Ä—è—Ç—å—Å—è –≤ –ø–∞—Ä—Ç–Ω—ë—Ä–µ. –ü—Ä–∞–∫—Ç–∏–∫–∞: –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Å–≤–æ—ë –≤—Ä–µ–º—è.");
    } else if ([1,8,22].includes(core)) {
      lines.push("–í–∞–∂–Ω—ã <strong>—É–≤–∞–∂–µ–Ω–∏–µ –∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ —Å–∏–ª—ã</strong>.");
      lines.push("–¢–µ–Ω—å: –∫–æ–Ω—Ç—Ä–æ–ª—å/—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ. –ü—Ä–∞–∫—Ç–∏–∫–∞: –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å—Å—è –æ –ø—Ä–∞–≤–∏–ª–∞—Ö, –∞ –Ω–µ –¥–∞–≤–∏—Ç—å.");
    } else if ([3,5].includes(core)) {
      lines.push("–í–∞–∂–Ω—ã <strong>–ª—ë–≥–∫–æ—Å—Ç—å, –æ–±—â–µ–Ω–∏–µ, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è</strong>.");
      lines.push("–¢–µ–Ω—å: —Ä—É—Ç–∏–Ω–∞ —Å–Ω–∏–∂–∞–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å. –ü—Ä–∞–∫—Ç–∏–∫–∞: —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –Ω–æ–≤–∏–∑–Ω–∞.");
    } else if ([7,9,11].includes(core)) {
      lines.push("–í–∞–∂–Ω—ã <strong>—Å–º—ã—Å–ª, –≥–ª—É–±–∏–Ω–∞, –ª–∏—á–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</strong>.");
      lines.push("–¢–µ–Ω—å: –∑–∞–∫—Ä—ã—Ç–æ—Å—Ç—å. –ü—Ä–∞–∫—Ç–∏–∫–∞: –≥–æ–≤–æ—Ä–∏—Ç—å –æ —á—É–≤—Å—Ç–≤–∞—Ö —Å–ª–æ–≤–∞–º–∏.");
    }

    if (lifePath === 2) lines.push("–ü—É—Ç—å 2 —É—Å–∏–ª–∏–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–µ: –≤—ã–±–∏—Ä–∞–π —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —É–≤–∞–∂–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.");
    if (lifePath === 5) lines.push("–ü—É—Ç—å 5 —É—Å–∏–ª–∏–≤–∞–µ—Ç —Å–≤–æ–±–æ–¥—É: –¥–æ–≥–æ–≤–æ—Ä–∏—Ç–µ—Å—å –æ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∑–∞—Ä–∞–Ω–µ–µ.");
    if (lifePath === 4) lines.push("–ü—É—Ç—å 4 —É—Å–∏–ª–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: —Ü–µ–Ω–∏—à—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å.");

    return lines.join("<br/>");
  }

  function buildEnergyBlock(core, counts){
    const lines = [];
    if ([7,9,11].includes(core)) {
      lines.push("–†–µ—Å—É—Ä—Å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ <strong>—Ç–∏—à–∏–Ω–µ, —Å–Ω–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –≥–∏–≥–∏–µ–Ω–µ</strong>.");
    } else if ([1,8,22].includes(core)) {
      lines.push("–†–µ—Å—É—Ä—Å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ <strong>—Ü–µ–ª–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏–∏</strong>. –í—ã–≥–æ—Ä–∞–Ω–∏–µ ‚Äî –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑ –æ—Ç–¥—ã—Ö–∞.");
    } else if ([2,6,33].includes(core)) {
      lines.push("–†–µ—Å—É—Ä—Å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ <strong>—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥–∏–≥–∏–µ–Ω–µ</strong>. –í—ã–≥–æ—Ä–∞–Ω–∏–µ ‚Äî –∫–æ–≥–¥–∞ –º–Ω–æ–≥–æ —á—É–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º.");
    } else if ([3,5].includes(core)) {
      lines.push("–†–µ—Å—É—Ä—Å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ <strong>—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–∏</strong>. –í—ã–≥–æ—Ä–∞–Ω–∏–µ ‚Äî –æ—Ç —Ä—É—Ç–∏–Ω—ã.");
    } else if ([4].includes(core)) {
      lines.push("–†–µ—Å—É—Ä—Å –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–∞ <strong>—Ä–µ–∂–∏–º–µ</strong>. –í—ã–≥–æ—Ä–∞–Ω–∏–µ ‚Äî –æ—Ç —Ö–∞–æ—Å–∞ –∏ –Ω–µ–¥–æ—Å—ã–ø–∞.");
    }

    const c4 = counts[4] ?? 0;
    const c2 = counts[2] ?? 0;

    if (c4 === 0) lines.push("–ú–∞—Ç—Ä–∏—Ü–∞: <strong>4 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</strong> ‚Äî –±–µ—Ä–µ–≥–∏ —Ç–µ–ª–æ: —Å–æ–Ω, –≤–æ–¥–∞, —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å.");
    if (c4 >= 2) lines.push("–ú–∞—Ç—Ä–∏—Ü–∞: <strong>—Å–∏–ª—å–Ω–∞—è 4</strong> ‚Äî —Ä–µ—Å—É—Ä—Å —Ö–æ—Ä–æ—à–∏–π, –Ω–æ –Ω–µ –∑–∞–∫–∞–ø—ã–≤–∞–π—Å—è –≤ —Ä—É—Ç–∏–Ω—É.");
    if (c2 === 0) lines.push("–ú–∞—Ç—Ä–∏—Ü–∞: <strong>2 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</strong> ‚Äî —ç–º–æ—Ü–∏–∏ –ª—É—á—à–µ –ø—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å, —á—Ç–æ–±—ã –Ω–µ –∫–æ–ø–∏—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.");
    if (c2 >= 2) lines.push("–ú–∞—Ç—Ä–∏—Ü–∞: <strong>—Å–∏–ª—å–Ω–∞—è 2</strong> ‚Äî —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è: —Ñ–∏–ª—å—Ç—Ä—É–π –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –Ω–æ–≤–æ—Å—Ç–∏.");

    return lines.join("<br/>");
  }

  // ====== Export: collect blocks and build report ======
  function collectBlocksForExport(){
    const blocks = [];
    const results = document.getElementById('results');
    if (!results) return blocks;

    const cards = [
      {id:'summaryCard', title:'–ü–∞—Å–ø–æ—Ä—Ç –ª–∏—á–Ω–æ—Å—Ç–∏'},
      {id:'coreCard', title:'–ö–ª—é—á–µ–≤—ã–µ –∫–æ–¥—ã', detail:'full'},
      {id:'matrixCard', title:'–ú–∞—Ç—Ä–∏—Ü–∞ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è', detail:'full'},
      {id:'portraitCard', title:'–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç', detail:'full'},
      {id:'lifeAreasCard', title:'–°—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏', detail:'full'},
      {id:'forecastCard', title:'–ü—Ä–æ–≥–Ω–æ–∑ –∏ —Ü–∏–∫–ª—ã', detail:'full'},
      {id:'recommendCard', title:'–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏'}
    ];

    for (const c of cards){
      if (c.detail === 'full' && VIEW_MODE !== 'full') continue;
      const el = document.getElementById(c.id);
      if (!el) continue;
      blocks.push({ id: c.id, title: c.title, html: el.innerHTML });
    }
    return blocks;
  }

  function buildReportHtmlDocument({viewMode, fullName, birthCity, birthDate, blocks}){
    const safeDate = new Date(birthDate).toLocaleDateString('ru-RU');
    const now = new Date().toLocaleString('ru-RU');

    const reportCss = `
      :root{
        --bg:#0b0b12; --card:#141427; --text:#e9e9f2; --muted:#b9b9cc;
        --primary:#7c3aed; --accent:#fbbf24; --danger:#fb7185; --border: rgba(255,255,255,0.10);
      }
      *{box-sizing:border-box}
      body{
        margin:0; padding:22px;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color:var(--text); background: var(--bg); line-height:1.6;
      }
      .wrap{max-width:980px;margin:0 auto}
      .top{
        display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;
        padding:12px 0 18px; border-bottom:1px solid rgba(255,255,255,0.10); margin-bottom:14px;
      }
      h1{margin:0;font-size:24px}
      .meta{color:var(--muted); font-size:13px}
      .card{
        background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent 55%), var(--card);
        border:1px solid var(--border);
        border-radius:16px;
        padding:16px;
        margin:12px 0;
      }
      .footer{
        margin-top:18px;
        color:var(--muted);
        font-size:12px;
        text-align:center;
        padding:10px 0;
        border-top:1px solid rgba(255,255,255,0.10);
      }
      /* print */
      @media print{
        body{background:#fff;color:#111}
        .card{background:#fff;border:1px solid #ddd}
        .meta,.footer{color:#444}
      }
    `;

    const bodyCards = blocks.map(b => `
      <div class="card">
        ${b.html}
      </div>
    `).join('\n');

    const disclaimer = `
      <div class="card">
        <div style="color:var(--muted);font-size:13px">
          –†–µ–∂–∏–º –æ—Ç—á—ë—Ç–∞: <strong>${viewMode === 'full' ? '–ü–æ–¥—Ä–æ–±–Ω–æ' : '–ö—Ä–∞—Ç–∫–æ'}</strong><br/>
          –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —ç—Ç–æ—Ç –æ—Ç—á—ë—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∞–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å.
        </div>
      </div>
    `;

    return `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç ‚Äî –û—Ç—á—ë—Ç</title>
  <style>${reportCss}</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>üîÆ –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ü–∞—Å–ø–æ—Ä—Ç ‚Äî –û—Ç—á—ë—Ç</h1>
        <div class="meta">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ: ${escapeHtml(now)}</div>
      </div>
      <div class="meta" style="text-align:right">
        <div><strong>${escapeHtml(fullName)}</strong></div>
        <div>${escapeHtml(birthCity)} ‚Ä¢ ${escapeHtml(safeDate)}</div>
      </div>
    </div>

    ${bodyCards}
    ${disclaimer}

    <div class="footer">
      –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Ä¢ —Ñ–∞–π–ª –º–æ–∂–Ω–æ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    </div>
  </div>
</body>
</html>`;
  }

  // ====== Export actions ======
  function openExportModal(){
    if (!LAST_REPORT_HTML){
      alert("–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π —Ä–∞—Å—á—ë—Ç, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç.");
      return;
    }
    const modal = document.getElementById('exportModal');
    const ta = document.getElementById('exportTextarea');
    ta.value = LAST_REPORT_HTML;
    modal.style.display = 'flex';
  }
  function closeExportModal(){
    document.getElementById('exportModal').style.display = 'none';
  }

  function copyReportHtml(){
    const ta = document.getElementById('exportTextarea');
    if (!ta.value) return;
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    try{
      document.execCommand('copy');
      alert("HTML –æ—Ç—á—ë—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.");
    } catch(e){
      navigator.clipboard?.writeText(ta.value);
      alert("HTML –æ—Ç—á—ë—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.");
    }
  }

  function downloadReportHtml(){
    if (!LAST_REPORT_HTML){
      alert("–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π —Ä–∞—Å—á—ë—Ç, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç.");
      return;
    }
    const blob = new Blob([LAST_REPORT_HTML], {type:"text/html;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const ts = new Date();
    const pad = (n)=> String(n).padStart(2,'0');
    const fileName = `passport_report_${ts.getFullYear()}-${pad(ts.getMonth()+1)}-${pad(ts.getDate())}.html`;
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1000);
  }

  function openReportInNewTab(){
    if (!LAST_REPORT_HTML){
      alert("–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π —Ä–∞—Å—á—ë—Ç, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç.");
      return;
    }
    const blob = new Blob([LAST_REPORT_HTML], {type:"text/html;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    window.open(url, "_blank", "noopener,noreferrer");
    setTimeout(()=>URL.revokeObjectURL(url), 2000);
  }

  // Close modal on overlay click
  document.getElementById('exportModal').addEventListener('click', (e)=>{
    if (e.target.id === 'exportModal') closeExportModal();
  });
</script>
</body>
</html>
